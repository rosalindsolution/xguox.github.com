
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Rails 3 Remote Links and Forms: A Definitive Guide - XguoX</title>
  <meta name="author" content="XguoX">

  
  <meta name="description" content="楼主物语： 这些天遇上一些困难请教Larry的时候他没少给我一些英文的资料，虽然能够阅读，但是始终觉得翻译回中文以后再看也方便些。不过有些地方翻的比较蹩脚呀。 原文：Rails 3 Remote Links and Forms: A Definitive Guide Spoiler Alert: &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://xguox.github.com/blog/2012/07/11/rails-3-remote-links-and-forms/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
   <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="XguoX" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39166710-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
</hgroup>

</header>
  <!-- <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:xguox.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav> -->
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Rails 3 Remote Links and Forms: A Definitive Guide</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-11T11:28:00+08:00" pubdate data-updated="true">Jul 11<span>th</span>, 2012</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><h2>楼主物语：</h2>

<blockquote><p>这些天遇上一些困难请教Larry的时候他没少给我一些英文的资料，虽然能够阅读，但是始终觉得翻译回中文以后再看也方便些。不过有些地方翻的比较蹩脚呀。</p>

<p>原文：<a href="http://www.alfajango.com/blog/rails-3-remote-links-and-forms/">Rails 3 Remote Links and Forms: A Definitive Guide</a></p></blockquote>

<!-- more -->


<p>Spoiler Alert:如果你喜欢魔法，请停止阅读这篇文章。因为，让rails的表单、连接、输入等如此强大的Rails 3 UJS驱动—-rails.js,当你知道它的工作原理后，你就知道其实它没有多么的神奇。</p>

<h2>rails.js做什么</h2>

<ol>
<li>它找到远程链接、表单和输入，并通过Ajax覆盖这些的click事件以提交到服务器端。</li>
<li>它触发6种javascript事件来让你绑定一些回调函数用以处理和操纵这个Ajax响应</li>
<li><del>它处理从服务器端得到的Ajax回应</del></li>
</ol>


<h2>rails.js不做什么</h2>

<p>请注意到上述最后一点是加了删除线的。当启用新的rails3远程功能时候，这似乎是混乱的最大来源。因为已经根深蒂固的习惯于rails2的 link_to_remote 与 remote_form_for,我们期待rails3也同样的会为我们的表单、链接处理Ajax响应。但是rails3却没有这么做，它把这些都交给你去完成。 Rails会做的是帮你把包裹搬上房间，但不会帮你打开包裹。This is by design;为什么你想要侍从帮你使用你的东西呢？同样的，每个元素的数据实际处理方式很大程度上是独一无二的，并且取决于你再各种情况下工作所得的的数据。所以，Rails把这一部分留给你来做决定，而我们则回到了过去。</p>

<h2>HTML5的角色</h2>

<p>你可能已经听说Rails3将使用HTML5。的确是的。但HTML5所扮演的实际角色并没有你想象中的那么重要。 是否还记得rails.js所做的第一样东西。在它能覆盖所有远程元素的click事件和submit事件前，它需要先找到这些所有的元素。 因此，我们需要一种方法来指定我们的远程元素。在以前，我们可能会添加 class=”remote” 到我们的远程元素。但现在，所有的class属性都跟样式相关联了。难道就没有一种办法能区分出远程元素而不用污染到我们的CSS类。 这，在HTML5中是有的。有这么一段HTML5规范:现在，你可以添加任意标签到一个HTML元素，只要这个标签的起始部分是”data-“.因此，下面这是一个有效的HTML标记：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;stuff.hml&quot;</span> <span class="na">data-rocketsocks=</span><span class="s">&quot;whateva&quot;</span><span class="err">]]</span> <span class="nt">&gt;</span> Blast off!<span class="err">&lt;</span>/a]] &gt;
</span></code></pre></td></tr></table></div></figure>


<p>Rails 3充分利用了这种新的HTML标记，它通过在HTML元素中添加 :remote => true 来转换所有的链接和表单使其拥有了标签 data-remote = true</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="err">&lt;</span>%= link_to &quot;Get remote sauce&quot;, {:action =&gt; &quot;sauce&quot;}, :remote =&gt; true, :class =&gt; &quot;button-link&quot; %&gt;# =&gt; <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;sauce&quot;</span> <span class="na">class=</span><span class="s">&quot;button-link&quot;</span> <span class="na">data-remote=</span><span class="s">true</span><span class="nt">&gt;</span>Get remote sauce<span class="nt">&lt;/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>现在rails.js通过如下的选择器找到所有的远程链接：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;form[data-remote]&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;a[data-remote],input[data-remote]&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>并且分别通过一个ajax请求到form的action和link的href属性从而重载了submit和click动作， Then it does the same thing wirh remote forms and inputs, using the form’s action. 就是这样，HTML5只是提供一个方便、语法、方式给我们用以指定及选择劫持哪个元素（？？？）</p>

<h2>处理Ajax响应</h2>

<p>那么，我们到底是如何根据ajax响应做一些事情呢？幸运的是，当rails.js远程发送你的请求时，它同时也触发了6个自定义事件，并传输相应的数据/响应到每一个事件。你也可以绑定你自己的处理函数到这些事件。 这6个事件是：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">ajax</span><span class="o">:</span><span class="nx">before</span>
</span><span class='line'><span class="nx">ajax</span><span class="o">:</span><span class="nx">loading</span>
</span><span class='line'><span class="nx">ajax</span><span class="o">:</span><span class="nx">success</span>
</span><span class='line'><span class="nx">ajax</span><span class="o">:</span><span class="nx">failure</span>
</span><span class='line'><span class="nx">ajax</span><span class="o">:</span><span class="nx">complete</span>
</span><span class='line'><span class="nx">ajax</span><span class="o">:</span><span class="nx">after</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Update:</h2>

<blockquote><p>在这篇文章写下后，rails团队对 jQuery UJS driver 做了些改动。在最新版本的rails.js中，只剩下了以下4个回调事件：</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">ajax</span><span class="o">:</span><span class="nx">beforeSend</span>
</span><span class='line'><span class="nx">ajax</span><span class="o">:</span><span class="nx">success</span>
</span><span class='line'><span class="nx">ajax</span><span class="o">:</span><span class="nx">complete</span>
</span><span class='line'><span class="nx">ajax</span><span class="o">:</span><span class="nx">error</span>
</span></code></pre></td></tr></table></div></figure>


<p>这样，在你的页面中，你将会像下面这样绑定这些事件到一个函数中：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.button-link&#39;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;ajax:success&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>  <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Success!&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>你会发现，通过绑定一些函数到实体/事件，在rails中的所有的javascript功能都是很方便的。</p>

<p>Binding is good，因为它不是引人注目的。javascript功能和html标记分别作为完全独立单位但通过javascript绑定在一起的存在。如果用户没有用到javascript，那么javascript所绑定到html实体的js函数将永远不会被执行，用户所得到的，只是干干净净、有效的HTML</p>

<h2>把他们都放在一起</h2>

<p>解释的足够多了，下面让我们建立一个加载一些内容到页面的远程表单。我们会提供给用户即时反馈，完整地处理所有的错误，以及能让用户重置表单再做一次。有了以上知识的武装，希望下面的没有人会看起来以为是魔法。 接下来，我们将假定在我们的rails app中，有一个Comment model,且该model在数据库中有一个text类型的”content”字段。通过提交一个远程表单，我们能让用户创建一个comment，并将这个comment插入到页面中。</p>

<blockquote><p>你可能注意到，我们直接请求了一个html的响应，但却以JSON的形式返回一些错误。我们使用 respond_with 覆盖了许多魔术方法。这一切说明我们在请求/响应中有多大的控制权。</p>

<p>接着的Part2将通过一个更production-appropriate的例子叙述了如何请求一个JS（xml,json,文本或其他）的响应。</p></blockquote>

<h2>View</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= form_for @comment, :remote =</span><span class="o">&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:html</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:&#39;data-type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="ss">:id</span> <span class="o">=&gt;</span> <span class="s1">&#39;create_comment_form&#39;</span> <span class="p">}</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="sx">%&gt;  &lt;%= f.text_area(:content) %&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;validation-error&quot;</span><span class="o">&gt;&lt;</span><span class="sr">/div&gt;</span>
</span><span class='line'><span class="sr">  &lt;%= f.submit %&gt;</span>
</span><span class='line'><span class="sr">&lt;% end %&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;div id=&quot;comments&quot;&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Controller</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">respond_to</span> <span class="ss">:html</span><span class="p">,</span> <span class="ss">:xml</span><span class="p">,</span> <span class="ss">:json</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>  <span class="vi">@comment</span> <span class="o">=</span> <span class="no">Comment</span><span class="o">.</span><span class="n">new</span><span class="p">(</span> <span class="n">params</span><span class="o">[</span><span class="ss">:comment</span><span class="o">]</span> <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="vi">@comment</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>    <span class="n">respond_with</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="k">do</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">xhr?</span>
</span><span class='line'>          <span class="n">render</span> <span class="ss">:partial</span> <span class="o">=&gt;</span> <span class="s2">&quot;comments/show&quot;</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:comment</span> <span class="o">=&gt;</span> <span class="vi">@comment</span> <span class="p">},</span> <span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="ss">:created</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>          <span class="n">redirect_to</span> <span class="vi">@comment</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="n">respond_with</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="k">do</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">xhr?</span>
</span><span class='line'>          <span class="n">render</span> <span class="ss">:json</span> <span class="o">=&gt;</span> <span class="vi">@comment</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="ss">:unprocessable_entity</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>          <span class="n">render</span> <span class="ss">:action</span> <span class="o">=&gt;</span> <span class="ss">:new</span><span class="p">,</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="ss">:unprocessable_entity</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>显而易见的，我们需要一个显示comment的partial模板 _show.html.erb 。希望你知道如何做到。</p>

<p>在这一点上，我们有一个提交到远程服务器上的表单，并且我们的服务器响应以我们在view中的partial，并准备插入到页面中去。但有一点是，它并不是真正的被插入到页面中。</p>

<h2>Javascript</h2>

<p>是时候绑定一些处理函数到那些触发的ajax事件。因此，在我们的表单页面中，我们将希望加载这个javascript（可能会在标签或者在一个分离开的js文件）</p>

<blockquote><p>Update:</p>

<p>下面这段已经更新以绑定到最新版本的rails.js所允许的回调。</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#create_comment_form&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;ajax:beforeSend&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">settings</span><span class="p">){</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">$submitButton</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;commit&quot;]&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Update the text of the submit button to let the user know stuff is happening.</span>
</span><span class='line'>      <span class="c1">// But first, store the original text of the submit button, so it can be restored when the request is finished.</span>
</span><span class='line'>      <span class="nx">$submitButton</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="s1">&#39;origText&#39;</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">text</span><span class="p">()</span> <span class="p">);</span>
</span><span class='line'>      <span class="nx">$submitButton</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span> <span class="s2">&quot;Submitting...&quot;</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;ajax:success&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">){</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">$form</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Reset fields and any validation errors, so form can be used again, but leave hidden_field values intact.</span>
</span><span class='line'>      <span class="nx">$form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;textarea,input[type=&quot;text&quot;],input[type=&quot;file&quot;]&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">$form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;div.validation-error&#39;</span><span class="p">).</span><span class="nx">empty</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Insert response partial into page below the form.</span>
</span><span class='line'>      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#comments&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;ajax:complete&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">status</span><span class="p">){</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">$submitButton</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;commit&quot;]&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Restore the original submit button text</span>
</span><span class='line'>      <span class="nx">$submitButton</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;origText&#39;</span><span class="p">)</span> <span class="p">);</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;ajax:error&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">error</span><span class="p">){</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">$form</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
</span><span class='line'>          <span class="nx">errors</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">errorText</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Populate errorText with the comment errors</span>
</span><span class='line'>        <span class="nx">errors</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">parseJSON</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// If the responseText is not valid JSON (like if a 500 exception was thrown), populate errors with a generic error message.</span>
</span><span class='line'>        <span class="nx">errors</span> <span class="o">=</span> <span class="p">{</span><span class="nx">message</span><span class="o">:</span> <span class="s2">&quot;Please reload the page and try again&quot;</span><span class="p">};</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Build an unordered list from the list of errors</span>
</span><span class='line'>      <span class="nx">errorText</span> <span class="o">=</span> <span class="s2">&quot;There were errors with the submission: \n&lt;ul&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">for</span> <span class="p">(</span> <span class="nx">error</span> <span class="k">in</span> <span class="nx">errors</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">errorText</span> <span class="o">+=</span> <span class="s2">&quot;&lt;li&gt;&quot;</span> <span class="o">+</span> <span class="nx">error</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nx">errors</span><span class="p">[</span><span class="nx">error</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/li&gt; &quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">errorText</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/ul&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Insert error list into form</span>
</span><span class='line'>      <span class="nx">$form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;div.validation-error&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">errorText</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>这些函数每一个都能轻易地抽象化，这样他们能轻易地或者自动地应用在我们所有的远程表单中。</p></blockquote>

<p>这些绑定也以同样的方式工作于远程链接中。但我想我们已经使用了一个远程表单在这个例子中，由于这需要一些额外的但没有明显区别的步骤（例如清除表单或增添验证错误）</p>

<p>同时，需要注意到:从ajax事件所传输到你的函数的数据并不是在同一个顺序.在ajax:success中是 evt,data,status,xhr ，而在ajax:failure中是，eve,xhr,status,error。This will get ya every time.</p>

<h2>别急，还有更重要的</h2>

<p>如果你从文章开始就做足功课，并且看过了rails.js文件，你应该会注意到一些额外的细节。</p>

<h2>.live</h2>

<p>rails.js实际上用 .live() 而不是直接绑定click事件到远程表单、链接、输入。这样，在上面的javascript中，你可以替换 .bind() 为 .live() 显得更文艺一些。</p>

<h2>Update：</h2>

<blockquote><p>如果要在你的ajax处理中使用 .live() ,请确定你所使用的jQuery版本>v1.4.4,因为早些的版本会在IE中出现一些问题。</p></blockquote>

<h2>:confirm => “R U sure? ”</h2>

<p>你可能还会注意到 rails.js文件处理 :confirm => “R U sure? “(当你点击或者提交一些东西的时候嘣的弹出一个小窗口并显示”R U sure”（你也可以只写 :confirm => true 使用默认的信息）)，就像远程功能，Rails 3简单地添加有效的标签 data-confirm=true 到你的HTML元素</p>

<h2>:disable_with => “Submitting…”</h2>

<p>Rails 3给了我们另外的一个选项，:disable_with,这样当一个远程表单被提交的时候， we can give to form input elements to disable and re-label them.添加data-disable-with标签到这些输入中，使rails.js能选择和绑定这个功能。</p>

<p>想知道如何让远程表单或者链接工作于 js.erb(或者其他任何与之相关联的形式)，请看这篇文章的<a href="http://xguox.me/blog/2012/07/12/rails-3-remote-links-and-forms-part-2-data-type-with-jquery/">Part 2</a></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">XguoX</span></span>

      








  


<time datetime="2012-07-11T11:28:00+08:00" pubdate data-updated="true">Jul 11<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/rails/'>Rails</a>, <a class='category' href='/blog/categories/ruby/'>Ruby</a>, <a class='category' href='/blog/categories/translation/'>Translation</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://xguox.github.com/blog/2012/07/11/rails-3-remote-links-and-forms/" data-via="" data-counturl="http://xguox.github.com/blog/2012/07/11/rails-3-remote-links-and-forms/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/07/08/the-first-week-in-shanghai/" title="Previous Post: 安顿生活，融入上海">&laquo; 安顿生活，融入上海</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/07/12/rails-3-remote-links-and-forms-part-2-data-type-with-jquery/" title="Next Post: Rails 3 Remote Links and Forms Part 2: Data-type (With jQuery)">Rails 3 Remote Links and Forms Part 2: Data-type (With jQuery) &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <ul id="recent_posts">
      <li class="post">
      <a href="/" alt="Home"><img src="/images/Home.png"></a>
      <a href="/archives/" alt="Archives"><img src="/images/Calendar.png"></a>
      <a href="mailto:golvinlu@gmail.com" alt="E-Mail"><img src="/images/Envelope.png"></a>
      <a href="/about/" alt="About XguoX"><img src="/images/User.png"></a>
      <a href="http://gplus.to/xguox" alt="XguoX" target="_blank"><img src="/images/googleplus.png"></a>
      <a href="https://twitter.com/XguoX_L" alt="XguoX" target="_blank"><img src="/images/tw.png"></a>
      <a href="http://cn.linkedin.com/pub/grover-lu/65/8ba/4a5" alt="XguoX" target="_blank"><img src="/images/linkedin.png"></a>
      <a href="/atom.xml" alt="subscribe feed"><img src="/images/rss_big1.png"></a>
      </li>
  </ul>
</section>

<section>
<h1>Category</h1>
<span class='categories_tag'> <a href='/blog/categories/books' style='font-size: 101.93548387096774%'>Books</a>  <a href='/blog/categories/css' style='font-size: 101.93548387096774%'>Css</a>  <a href='/blog/categories/hexo' style='font-size: 101.93548387096774%'>Hexo</a>  <a href='/blog/categories/jabber' style='font-size: 160.0%'>Jabber</a>  <a href='/blog/categories/javascript' style='font-size: 101.93548387096774%'>Javascript</a>  <a href='/blog/categories/json' style='font-size: 101.93548387096774%'>Json</a>  <a href='/blog/categories/meteor' style='font-size: 113.54838709677419%'>Meteor</a>  <a href='/blog/categories/onepiece' style='font-size: 101.93548387096774%'>Onepiece</a>  <a href='/blog/categories/performance' style='font-size: 101.93548387096774%'>Performance</a>  <a href='/blog/categories/rails' style='font-size: 117.41935483870968%'>Rails</a>  <a href='/blog/categories/repost' style='font-size: 105.80645161290323%'>Repost</a>  <a href='/blog/categories/ruby' style='font-size: 117.41935483870968%'>Ruby</a>  <a href='/blog/categories/sublime' style='font-size: 101.93548387096774%'>Sublime</a>  <a href='/blog/categories/translation' style='font-size: 127.09677419354838%'>Translation</a>  <a href='/blog/categories/travel' style='font-size: 107.74193548387098%'>Travel</a> </span>
</section>


<section class="even">
<iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=0&noborder=0&isWeibo=1&isFans=0&uid=1660802261&verifier=0594649b&dpc=1"></iframe>
</section>



<section class="last odd">
<h1>My <span style="color: #0063dc;">Flick<span style="color: #ff0084;">r</h1>
<style type="text/css">
	#flickrList li { text-align: left; display:inline; margin: 0 2px 0 2px;}
</style>
<ul id="flickrList"></ul>
<script lang="Javascript">
var flickrNickname = "GroverLu";
function jsonFlickrApi(rsp) {
	if (rsp.stat != "ok"){
  		return;
 	}
 	var list = "";
 	for (var i=0; i < rsp.photos.photo.length; i++) {
  		var photo    = rsp.photos.photo[i];
  		var imgUrl   = 'http://farm'+ photo.farm +'.static.flickr.com/'+ photo.server +'/'+ photo.id +'_'+ photo.secret +'_s.jpg';
  		var photoUrl = 'http://www.flickr.com/photos/'+ flickrNickname +'/'+ photo.id;
  		list += '<li id="flickrItem_'+i+'"><a href="'+ photoUrl +'" title="'+ photo.title +'"><img alt="'+ photo.title +'" src="'+ imgUrl +'" /></a></li>';
 	}
 	document.getElementById('flickrList').innerHTML = list;
}
</script>
<script lang="Javascript" src="http://api.flickr.com/services/rest/?format=json&method=flickr.photos.search&user_id=94631627@N04&per_page=15&api_key=d286c7fecaa39173da37f6e681c443f6"></script>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/05/14/negative-energy/">负能量 - 从支纤镜说起 - 正能量</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/12/record-of-the-void-century-and-d/">[Repost]关于D一族的真相以及历史文本的分析</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/11/repost-days-with-my-father/">[Repost]与父亲在一起的日子 (组图)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/13/how-to-travel-around-the-world-for-a-year/">如何在一年里周游世界</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/13/traveling-writing-programming/">[Repost]旅行，写作，编程</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/11/jabber-sublime/">扯点Sublime</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/10/understanding-publications-and-subscriptions/">Understanding Publications and Subscriptions</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - XguoX -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

<!-- 
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39166710-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

  --></footer>
  

<script type="text/javascript">
      var disqus_shortname = 'xguox';
      
        
        // var disqus_developer = 1;
	    var disqus_identifier = 'http://xguox.github.com/blog/2012/07/11/rails-3-remote-links-and-forms/';
	    var disqus_url = 'http://xguox.github.com/blog/2012/07/11/rails-3-remote-links-and-forms/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
